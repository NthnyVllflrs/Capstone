{% extends 'base.html' %}

{% block content %}

{% if account_active %}
    
    <div id="timelineView">
        <div class="container">
            <div class="row mt-4">
                <div class="col-sm-12">
                    <h4>Timeline</h4>
                    <hr />
                </div>
                {% for report in object_list %}

                    <div class="col-sm-4 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">
                                    {{ report.emergency }}
                                    <small style="font-size: 0.5em;">{{ report.timestamp|timesince }} ago</small>
                                    <span class="badge badge-primary float-right" id="verifies_{{ report.id }}">{{ report.verifies.count }}</span>
                                </h4>
                                <hr class="my-3">
                                <ul class="list-unstyled">
                                    {% if report.reporter == request.user %}
                                        <li>Reporter : You</a></li>
                                    {% else %}
                                        <li>Reporter : <a href="{% url 'user:reporter-detail' report.reporter %}">{{ report.reporter }}</a></li>
                                    {% endif %}
                                        
                                    <li>Location : {{ report.address }}</li>
                                </ul>
                                <div class="float-right">
                                    <a class="btn btn-outline-primary btn-sm" href="{% url 'report:report-details' report.id %}">
                                        <i class="fa fa-info-circle" aria-hidden="true"></i>
                                        &nbspDetails
                                    </a>
                                    <button
                                        class="btn-verify btn btn-primary btn-sm font-weight-bold"
                                        data-href="{% url 'report:report-verify-toggle' report.id %}"
                                        data-verifies="{{ report.verifies.count }}"
                                        data-reportID="{{ report.id }}"
                                    >

                                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                                    &nbsp
                                    <span id="VerifyUnverify{{report.id}}">
                                        {% if request.user in report.verifies.all %}
                                            Unverify
                                        {% else %}
                                            Verify
                                        {% endif %}
                                    </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        {% if request.user.reporter %}
            calculateLocation()
        {% endif %}
        // setInterval(function(){ timelineLongPolling() }, 10000);
        timelineLongPolling()
    </script>
{% else %}

    <!-- Modal For User's Whos Accounts Are Deactivated -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Account Is Deactivated</h5>
            </div>
            <div class="modal-body">
                It looks like your account is currently deactivated. If this is a newly created account and you have followed the instructuions we sent to your email, the administrator may have not yet validated your account. If not, please send an email to capstonetechnopreneurship@gmail.com.
            </div>
            <div class="modal-footer">
                <a class="btn btn-block btn-primary" href="{% url 'user:user-logout' %}">Logout</a>
            </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $('#myModal').modal('show')
        });
    </script>

{% endif %}
    
{% endblock content %}