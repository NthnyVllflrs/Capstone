{% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3">
            <div class="row mt-3">
                <div class="col-sm-12">
                    <h5>Details</h5>
                    <hr />
                </div>
                <div class="container">
                    <ul class="list-group">
                        <li class="list-group-item">Type : {{ object.emergency }}</li>
                        <li class="list-group-item">Reporter : {{ object.reporter }}</li>
                        <li class="list-group-item">Occured : {{ object.timestamp|timesince }} ago</li>
                        <li class="list-group-item">Address : {{ object.address }}</li>
                        <li class="list-group-item">Verifies : <span id="verifies_{{ object.id }}">{{ object.verifies.count }}</span></li>
                        <li class="list-group-item">
                            <a
                                class="btn-verify btn btn-block btn-primary btn-sm font-weight-bold"
                                href="#"
                                data-href="{% url 'report:report-verify-toggle' object.id %}"
                                data-verifies="{{ object.verifies.count }}"
                                data-reportID="{{ object.id }}"
                            >

                                <i class="fa fa-check-circle" aria-hidden="true"></i>
                                &nbsp
                                <span id="VerifyUnverify{{object.id}}">
                                    {% if request.user in object.verifies.all %}
                                        Unverify
                                    {% else %}
                                        Verify
                                    {% endif %}
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>  
            </div>
        </div>
        <div class="col-sm-6">
            <div class="row mt-3">
                <div class="col-sm-12">
                    <h5>Map</h5>
                    <hr />
                </div>
                <div class="col-sm-12">
                    <div id="map" style="width:100%;height:500px;"></div>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="row mt-3">
                <div class="col-sm-12">
                    <h5>Route</h5>
                    <hr />
                </div>
                <div class="col-sm-12">
                    <div id="directionsPanel"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let reportLat = parseFloat('{{ object.latitude }}')
    let reportLng = parseFloat('{{ object.longitude }}')

    let userLat = parseFloat('{{ request.user.responder.latitude }}')
    let userLng = parseFloat('{{ request.user.responder.longitude }}')

    function initMap(){
        reportCoordinates = {lat: reportLat, lng: reportLng}
        var map = new google.maps.Map(document.getElementById('map'),{zoom: 18, center: reportCoordinates,})

        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        directionsDisplay.setMap(map);
        directionsDisplay.setPanel(document.getElementById('directionsPanel'));

        directionsService.route({
            origin: {lat: userLat, lng: userLng},
            destination: {lat: reportLat, lng: reportLng},
            travelMode: 'DRIVING'
        }, 
        function(response, status) {
            if (status === 'OK') {
                directionsDisplay.setDirections(response);
            } else {
                window.alert('Directions request failed due to ' + status);
            }
        });

        // var marker = new google.maps.Marker({
        //     position: reportCoordinates,
        //     map: map,
        // })
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBLvHFeixDacvhmdX-L_0EoG4of6n0pM1A&callback=initMap" type="text/javascript"></script>
{% endblock content %}